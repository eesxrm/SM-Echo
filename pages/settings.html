<!-- settings.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Settings</title>
  <link rel="stylesheet" href="../styles/style.css" />
</head>
<body>
  <header class="navbar">
    <a href="home.html">
      <img src="../assets/images/LOGO.PNG" alt="Echo Logo" class="logo" />
    </a>
    <div class="top-icons">
      <!-- Hamburger Menu -->
      <div class="dropdown">
        <button class="icon-button" onclick="toggleDropdown()">☰</button>
        <div id="dropdownContent" class="dropdown-content">
          <a href="insights.html">📊 Insights</a>
          <a href="savings.html">💰 Savings</a>
          <a href="goals.html">🎯 Goals</a>
        </div>
      </div>
      <a href="settings.html" class="icon-button">⚙️</a>
      <a href="chat.html" class="icon-button">👤</a>
      <a href="echolife.html" class="icon-button premium-star">⭐</a>
    </div>
  </header>

  <main class="home-container">
    <section class="welcome-card" style="text-align:left">
      <h2>⚙️ Settings</h2>
      <p>Personalise Echo to suit you. Theme, preferences, notifications, and more.</p>
    </section>

    <section class="settings-grid">
      <!-- Appearance -->
      <div class="card">
        <h3>🎨 Appearance</h3>
        <p>Switch between light and dark modes.</p>
        <label class="switch" aria-label="Dark mode">
          <input type="checkbox" id="darkModeToggle">
          <span class="slider"></span>
        </label>
      </div>

      <!-- Notifications -->
      <div class="card">
        <h3>🔔 Notifications</h3>
        <label><input type="checkbox" checked> Transaction alerts</label><br>
        <label><input type="checkbox" checked> Weekly summaries</label><br>
        <label><input type="checkbox"> Promotions</label><br>
        <button class="cta-button" style="margin-top:1rem" onclick="testNotification()">Test Notification</button>
      </div>

      <!-- Preferences -->
      <div class="card">
        <h3>⚙️ Preferences</h3>
        <label for="currencySelect">Currency</label><br>
        <select id="currencySelect">
          <option value="GBP">GBP (£)</option>
          <option value="USD">USD ($)</option>
          <option value="EUR">EUR (€)</option>
        </select>
        <br><br>
        <label for="languageSelect">Language</label><br>
        <select id="languageSelect">
          <option value="en">English</option>
          <option value="es">Spanish</option>
          <option value="fr">French</option>
        </select>
      </div>

      <!-- Security -->
      <div class="card">
        <h3>🛡 Security</h3>
        <p>Keep your account protected.</p>
        <button class="cta-button" onclick="openModal('changePasswordModal')">Change Password</button>
        <button class="cta-button" style="margin-left:.5rem" onclick="openModal('twoFAModal')">Enable 2FA</button>
      </div>

      <!-- Privacy -->
      <div class="card">
        <h3>🔒 Privacy</h3>
        <ul>
          <li>Never share your password</li>
          <li>Use two‑factor authentication</li>
          <li>Log out on public devices</li>
        </ul>
        <button class="cta-button" onclick="openModal('exportModal')">Data Export</button>
        <button class="cta-button" style="margin-left:.5rem" onclick="openModal('deleteModal')">Delete Account</button>
      </div>

      <!-- Support -->
      <div class="card">
        <h3>📞 Support</h3>
        <p>Need help? We’re here.</p>
        <p>Email: support@echoapp.com</p>
        <p>App Version: 1.0.0</p>
      </div>
    </section>
  </main>

  <!-- ===== Modals ===== -->

  <!-- Change Password -->
  <div id="changePasswordModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('changePasswordModal')">&times;</span>
      <h2>🔑 Change Password</h2>
      <form onsubmit="submitChangePassword(event)">
        <label>Current Password</label>
        <input type="password" required>
        <label>New Password</label>
        <input type="password" id="newPwd" minlength="6" required>
        <label>Confirm New Password</label>
        <input type="password" id="confirmPwd" minlength="6" required>
        <button type="submit" class="cta-button">Save</button>
      </form>
    </div>
  </div>

  <!-- Two-Factor Auth -->
  <div id="twoFAModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('twoFAModal')">&times;</span>
      <h2>📱 Enable 2FA</h2>
      <p>We’ll text a 6‑digit code to your phone.</p>
      <button class="cta-button" onclick="send2FACode()">Send Code</button>
      <div id="codeArea" style="display:none; margin-top:1rem">
        <label>Enter Code</label>
        <input type="text" id="twoFACode" maxlength="6" placeholder="123456">
        <button class="cta-button" onclick="enable2FA()">Verify & Enable</button>
      </div>
    </div>
  </div>

  <!-- Data Export -->
  <div id="exportModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('exportModal')">&times;</span>
      <h2>📦 Data Export</h2>
      <p>We’ll prepare a downloadable archive of your data and email you a link.</p>
      <button class="cta-button" onclick="prepareExport()">Prepare Export</button>
    </div>
  </div>

  <!-- Delete Account -->
  <div id="deleteModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('deleteModal')">&times;</span>
      <h2>⚠️ Delete Account</h2>
      <p>This is permanent. Type <strong>DELETE</strong> to confirm.</p>
      <input type="text" id="deleteConfirm" placeholder="Type DELETE">
      <button class="cta-button" onclick="confirmDeletion()">Confirm</button>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- Shared scripts -->
  <script>
    // Apply saved theme on load (shared)
    (function applySavedTheme(){
      const saved = localStorage.getItem('echo-theme');
      const prefers = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const useDark = saved ? saved === 'dark' : prefers;
      document.body.classList.toggle('dark-mode', useDark);
      if (!document.querySelector('meta[name=\"color-scheme\"]')) {
        const meta = document.createElement('meta');
        meta.name = 'color-scheme'; meta.content = 'light dark';
        document.head.appendChild(meta);
      }
    })();

    // Dropdown
    function toggleDropdown() {
      const dropdown = document.querySelector('.dropdown');
      if (dropdown) dropdown.classList.toggle('open');
    }
    window.addEventListener('click', function(e) {
      const dropdown = document.querySelector('.dropdown');
      if (dropdown && !dropdown.contains(e.target)) dropdown.classList.remove('open');
    });

    // Dark mode toggle + persist
    const DARK_KEY = 'echo-theme';
    const darkToggle = document.getElementById('darkModeToggle');
    if (darkToggle) {
      // reflect current state
      darkToggle.checked = document.body.classList.contains('dark-mode');
      darkToggle.addEventListener('change', function () {
        const useDark = this.checked;
        document.body.classList.toggle('dark-mode', useDark);
        localStorage.setItem(DARK_KEY, useDark ? 'dark' : 'light');
      });
    }

    // Modals
    function openModal(id){ document.getElementById(id).style.display='block'; }
    function closeModal(id){ document.getElementById(id).style.display='none'; }

    // Toast helper
    function showToast(msg) {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 2200);
    }

    // Handlers
    function submitChangePassword(e){
      e.preventDefault();
      const newPwd = document.getElementById('newPwd').value.trim();
      const confirmPwd = document.getElementById('confirmPwd').value.trim();
      if (newPwd.length < 6) return showToast('New password must be 6+ chars');
      if (newPwd !== confirmPwd) return showToast('Passwords do not match');
      closeModal('changePasswordModal');
      showToast('Password changed');
    }

    function send2FACode(){
      document.getElementById('codeArea').style.display = 'block';
      showToast('Code sent');
    }

    function enable2FA(){
      const code = document.getElementById('twoFACode').value.trim();
      if (code.length !== 6) return showToast('Enter 6‑digit code');
      closeModal('twoFAModal');
      showToast('2FA enabled');
    }

    function testNotification(){
      showToast('This is a test notification');
    }

    function prepareExport(){
      closeModal('exportModal');
      showToast('Export requested');
    }

    function confirmDeletion(){
      const val = document.getElementById('deleteConfirm').value.trim().toUpperCase();
      if (val !== 'DELETE') return showToast('Type DELETE to confirm');
      closeModal('deleteModal');
      showToast('Account deletion scheduled');
    }

    // Sync theme if changed in another tab
    window.addEventListener('storage', (e) => {
      if (e.key === DARK_KEY) {
        document.body.classList.toggle('dark-mode', e.newValue === 'dark');
        if (darkToggle) darkToggle.checked = e.newValue === 'dark';
      }
    });
  </script>
</body>
</html>
